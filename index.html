<!DOCTYPE html>
<html lang="ta">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>à®à®©à¯ Gallery - theepika_sweety</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: 'Segoe UI', sans-serif; background: #0f172a; color: #e2e8f0; padding: 20px; }
    .c { max-width: 1200px; margin: 0 auto; }
    h1 { text-align: center; color: #60a5fa; margin-bottom: 10px; }
    .s { text-align: center; color: #94a3b8; margin-bottom: 30px; }

    .up { background: #1e293b; padding: 20px; border-radius: 12px; margin: 20px 0; display: none; }
    .up.show { display: block; }
    .d { border: 2px dashed #475569; padding: 30px; text-align: center; border-radius: 10px; cursor: pointer; transition: all 0.3s; }
    .d:hover { border-color: #60a5fa; background: #1e3a8a20; }
    .p img, .p video { max-height: 180px; margin: 10px 0; border-radius: 8px; display: block; margin: 10px auto; }
    input, textarea, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #475569; background: #334155; color: #e2e8f0; }
    button { background: #3b82f6; color: white; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; }
    button:hover { background: #2563eb; }
    button:disabled { background: #475569; cursor: not-allowed; }

    .g { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; }
    .cd { background: #1e293b; border-radius: 12px; overflow: hidden; transition: 0.3s; }
    .cd:hover { transform: translateY(-5px); box-shadow: 0 8px 16px rgba(0,0,0,0.3); }
    .m { width: 100%; height: 220px; object-fit: cover; background: #334155; display: block; }
    .i { padding: 15px; }
    .n { font-weight: bold; color: #60a5fa; margin-bottom: 5px; font-size: 1.1rem; }
    .de { color: #cbd5e1; font-size: 0.9rem; margin-bottom: 10px; }
    .st { display: flex; justify-content: space-between; align-items: center; font-size: 0.9rem; margin-top: 10px; }
    .l { background: #334155; padding: 6px 12px; border-radius: 6px; cursor: pointer; transition: 0.3s; user-select: none; }
    .l:hover { background: #475569; }
    .l.liked { background: #fecaca; color: #dc2626; }
    .a { display: flex; gap: 8px; margin-top: 10px; }
    .b { flex: 1; padding: 10px; font-size: 0.9rem; border-radius: 6px; border: none; cursor: pointer; color: white; font-weight: bold; transition: 0.3s; }

    .e { text-align: center; padding: 50px; color: #64748b; font-size: 1.2rem; }
    .t { position: fixed; top: 20px; right: 20px; padding: 14px 20px; background: #10b981; color: white; border-radius: 8px; z-index: 1000; animation: slideIn 0.3s; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
    .t.err { background: #ef4444; }
    @keyframes slideIn { from { transform: translateX(100px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
  </style>
</head>
<body>
  <div class="c">
    <h1>ğŸ–¼ï¸ à®à®©à¯ Gallery</h1>
    <p class="s">à®‰à®©à®•à¯à®•à¯ à®®à®Ÿà¯à®Ÿà¯à®®à¯ à®¤à¯†à®°à®¿à®¯à¯à®®à¯... à®†à®©à®¾à®²à¯ share à®ªà®£à¯à®£à®²à®¾à®®à¯ ğŸ’™</p>

    <div class="up" id="uploadBox">
      <div class="d" id="dropZone">ğŸ“¤ à®•à¯‹à®ªà¯à®ªà¯ˆ à®‡à®´à¯à®¤à¯à®¤à¯ à®µà®¿à®Ÿà¯ à®…à®²à¯à®²à®¤à¯ à®•à®¿à®³à®¿à®•à¯ à®šà¯†à®¯à¯
        <input type="file" id="fileInput" accept="image/*,video/*" hidden />
      </div>
      <div class="p" id="preview"></div>
      <input type="text" id="nameInput" placeholder="ğŸ“ à®ªà¯†à®¯à®°à¯ (optional)" />
      <textarea id="descInput" placeholder="ğŸ’¬ à®µà®¿à®³à®•à¯à®•à®®à¯... (optional)" rows="3"></textarea>
      <button id="uploadBtn" disabled>â¬†ï¸ à®ªà®¤à®¿à®µà¯‡à®±à¯à®±à¯</button>
    </div>

    <div class="g" id="gallery"></div>
  </div>

  <script>
    const REPO = 'adflyaa/theepika_sweety';
    const DATA_PATH = 'docs/data.json';
    const PASSWORD = 'uu934587kk';
    
    let files = [];
    let likes = JSON.parse(localStorage.getItem('likes') || '{}');
    let isAdmin = false;

    const pwd = prompt('ğŸ”’ Password enter à®ªà®£à¯à®£à¯:');
    if (pwd === PASSWORD) {
      isAdmin = true;
      document.getElementById('uploadBox').classList.add('show');
    }

    async function loadData() {
      try {
        const res = await fetch(`https://raw.githubusercontent.com/${REPO}/main/${DATA_PATH}?t=${Date.now()}`);
        files = await res.json();
        renderGallery();
        trackViews();
      } catch (err) {
        console.error('Load error:', err);
        document.getElementById('gallery').innerHTML = '<div class="e">ğŸ“­ à®‡à®©à¯à®©à¯à®®à¯ à®•à¯‹à®ªà¯à®ªà¯à®•à®³à¯ à®‡à®²à¯à®²à¯ˆ</div>';
      }
    }

    function renderGallery() {
      const urlId = new URLSearchParams(location.search).get('id');
      document.getElementById('gallery').innerHTML = files.map((f, i) => `
        <div class="cd" ${f.id === urlId ? 'style="border:3px solid #60a5fa;"' : ''}>
          ${f.type.startsWith('image') 
            ? `<img src="${f.data}" class="m" alt="${f.name}">` 
            : `<video src="${f.data}" class="m" controls></video>`}
          <div class="i">
            <div class="n">${f.name}</div>
            ${f.desc ? `<div class="de">${f.desc}</div>` : ''}
            <div class="st">
              <span>ğŸ‘ï¸ Views: ${f.views || 0}</span>
              <div class="l ${likes[f.id] ? 'liked' : ''}" onclick="toggleLike(${i})">
                ${likes[f.id] ? 'â¤ï¸ Liked' : 'ğŸ¤ Like'} (${f.likes || 0})
              </div>
            </div>
            <div class="a">
              <button class="b" style="background:#10b981" onclick="downloadFile(${i})">â¬‡ï¸ Download</button>
              <button class="b" style="background:#3b82f6" onclick="shareFile(${i})">ğŸ”— Share</button>
            </div>
          </div>
        </div>
      `).join('');
    }

    function toggleLike(index) {
      const fileId = files[index].id;
      if (likes[fileId]) {
        showToast('âš ï¸ à®à®±à¯à®•à®©à®µà¯‡ like à®ªà¯‹à®Ÿà¯à®Ÿà®¾à®¯à¯!', true);
        return;
      }
      files[index].likes = (files[index].likes || 0) + 1;
      likes[fileId] = true;
      localStorage.setItem('likes', JSON.stringify(likes));
      updateData();
      renderGallery();
      showToast('â¤ï¸ Like à®ªà¯‹à®Ÿà¯à®Ÿà®¾à®¯à¯!');
    }

    function shareFile(index) {
      const file = files[index];
      const url = `${location.origin}${location.pathname}?id=${file.id}`;
      navigator.clipboard.writeText(url).then(() => showToast('ğŸ”— Link copied! WhatsApp-à®²à¯ paste à®šà¯†à®¯à¯'));
      if (navigator.share) {
        navigator.share({ title: file.name, text: file.desc || 'Check out this!', url });
      }
    }

    function downloadFile(index) {
      const file = files[index];
      const a = document.createElement('a');
      a.href = file.data;
      a.download = file.name;
      a.click();
      showToast('â¬‡ï¸ Download start!');
    }

    function trackViews() {
      const sessionViews = JSON.parse(sessionStorage.getItem('views') || '{}');
      files.forEach(f => {
        if (!sessionViews[f.id]) {
          f.views = (f.views || 0) + 1;
          sessionViews[f.id] = true;
        }
      });
      sessionStorage.setItem('views', JSON.stringify(sessionViews));
      updateData();
    }

    async function updateData() {
      if (!isAdmin) return;
      try {
        const shaRes = await fetch(`https://api.github.com/repos/${REPO}/contents/${DATA_PATH}`);
        const shaData = await shaRes.json();
        await fetch(`https://api.github.com/repos/${REPO}/contents/${DATA_PATH}`, {
          method: 'PUT',
          headers: {
            'Authorization': 'token GH_PAT_WILL_BE_HERE',
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            message: 'Update gallery data',
            content: btoa(unescape(encodeURIComponent(JSON.stringify(files, null, 2)))),
            sha: shaData.sha
          })
        });
      } catch (err) { console.error('Update error:', err); }
    }

    document.getElementById('dropZone').onclick = () => document.getElementById('fileInput').click();
    document.getElementById('fileInput').onchange = (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (ev) => {
        const previewHtml = file.type.startsWith('image')
          ? `<img src="${ev.target.result}">`
          : `<video src="${ev.target.result}" controls></video>`;
        document.getElementById('preview').innerHTML = previewHtml;
        document.getElementById('uploadBtn').disabled = false;
      };
      reader.readAsDataURL(file);
    };

    document.getElementById('uploadBtn').onclick = () => {
      const file = document.getElementById('fileInput').files[0];
      if (!file) return;
      const name = document.getElementById('nameInput').value || file.name;
      const desc = document.getElementById('descInput').value;
      const reader = new FileReader();
      reader.onload = (ev) => {
        const newFile = {
          id: Date.now().toString(),
          name, desc,
          data: ev.target.result, type: file.type, likes: 0, views: 0
        };
        files.unshift(newFile);
        updateData();
        loadData();
        document.getElementById('preview').innerHTML = '';
        document.getElementById('nameInput').value = '';
        document.getElementById('descInput').value = '';
        document.getElementById('fileInput').value = '';
        document.getElementById('uploadBtn').disabled = true;
        showToast('âœ… à®ªà®¤à®¿à®µà¯‡à®±à¯à®±à®®à¯ à®µà¯†à®±à¯à®±à®¿!');
      };
      reader.readAsDataURL(file);
    };

    function showToast(message, isError = false) {
      const toast = document.createElement('div');
      toast.className = 't' + (isError ? ' err' : '');
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    loadData();
  </script>
</body>
    </html>
