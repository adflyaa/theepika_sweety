<!DOCTYPE html>
<html lang="ta">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üñºÔ∏è Gallery - Theepika Sweety</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { 
      font-family: 'Segoe UI', sans-serif; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff; 
      padding: 20px;
      min-height: 100vh;
    }
    .container { max-width: 1200px; margin: 0 auto; }
    
    h1 { 
      text-align: center; 
      font-size: 2.5rem;
      margin: 20px 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    .subtitle { 
      text-align: center; 
      opacity: 0.9;
      margin-bottom: 30px;
      font-size: 1.1rem;
    }

    /* Admin Button */
    .admin-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(255,255,255,0.2);
      backdrop-filter: blur(10px);
      padding: 10px 20px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.9rem;
      border: 2px solid rgba(255,255,255,0.3);
      transition: 0.3s;
      z-index: 100;
    }
    .admin-btn:hover {
      background: rgba(255,255,255,0.3);
    }

    /* Upload Box - Admin Only */
    .upload-box { 
      background: rgba(255,255,255,0.1); 
      backdrop-filter: blur(10px);
      padding: 25px; 
      border-radius: 15px; 
      margin: 20px 0; 
      display: none;
      border: 2px solid rgba(255,255,255,0.2);
    }
    .upload-box.show { display: block; }
    
    .drop-zone { 
      border: 3px dashed rgba(255,255,255,0.4); 
      padding: 40px; 
      text-align: center; 
      border-radius: 12px; 
      cursor: pointer; 
      transition: all 0.3s;
      background: rgba(255,255,255,0.05);
    }
    .drop-zone:hover { 
      border-color: rgba(255,255,255,0.8); 
      background: rgba(255,255,255,0.1);
    }
    
    .preview { text-align: center; margin: 15px 0; }
    .preview img, .preview video { 
      max-height: 200px; 
      margin: 15px auto; 
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
      display: block;
    }
    
    input, textarea, button { 
      width: 100%; 
      padding: 14px; 
      margin: 10px 0; 
      border-radius: 10px; 
      border: 2px solid rgba(255,255,255,0.3);
      background: rgba(255,255,255,0.1);
      color: #fff;
      font-size: 1rem;
    }
    input::placeholder, textarea::placeholder {
      color: rgba(255,255,255,0.6);
    }
    
    button { 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none; 
      font-weight: bold; 
      cursor: pointer;
      transition: 0.3s;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    button:hover { 
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.3);
    }
    button:disabled { 
      background: rgba(255,255,255,0.2);
      cursor: not-allowed;
    }

    /* Gallery Grid */
    .gallery { 
      display: grid; 
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
      gap: 25px; 
      margin-top: 30px;
    }
    
    .card { 
      background: rgba(255,255,255,0.1); 
      backdrop-filter: blur(10px);
      border-radius: 15px; 
      overflow: hidden;
      transition: 0.3s;
      border: 2px solid rgba(255,255,255,0.2);
    }
    .card:hover { 
      transform: translateY(-10px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.3);
    }
    
    .media { 
      width: 100%; 
      height: 250px; 
      object-fit: cover; 
      display: block;
      background: rgba(0,0,0,0.2);
    }
    
    .info { padding: 20px; }
    .name { 
      font-weight: bold; 
      font-size: 1.3rem;
      margin-bottom: 8px;
    }
    .desc { 
      opacity: 0.9;
      font-size: 0.95rem; 
      margin-bottom: 15px;
      line-height: 1.5;
    }
    
    /* Stats - Visible to everyone */
    .stats { 
      display: flex; 
      justify-content: space-between; 
      align-items: center;
      font-size: 0.95rem;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid rgba(255,255,255,0.2);
    }
    
    .like-btn { 
      background: rgba(255,255,255,0.2);
      padding: 10px 18px; 
      border-radius: 25px; 
      cursor: pointer;
      transition: 0.3s;
      user-select: none;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      font-weight: 600;
    }
    .like-btn:hover { 
      background: rgba(255,255,255,0.3);
      transform: scale(1.05);
    }
    .like-btn.liked { 
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      animation: pulse 0.3s;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    
    /* Admin Actions - Only visible to admin */
    .admin-actions { 
      display: none;
      gap: 10px; 
      margin-top: 15px;
    }
    .admin-actions.show {
      display: flex;
    }
    
    .action-btn { 
      flex: 1; 
      padding: 12px; 
      font-size: 0.9rem; 
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: bold;
      transition: 0.3s;
      color: white;
    }
    .action-btn:hover { 
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }

    .empty { 
      text-align: center; 
      padding: 60px 20px;
      font-size: 1.3rem;
      opacity: 0.7;
    }
    
    .toast { 
      position: fixed; 
      top: 30px; 
      right: 30px; 
      padding: 16px 24px; 
      background: rgba(255,255,255,0.95);
      color: #333;
      border-radius: 10px; 
      z-index: 1000; 
      animation: slideIn 0.3s;
      box-shadow: 0 8px 16px rgba(0,0,0,0.3);
      font-weight: 500;
    }
    .toast.error { 
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: #fff;
    }
    
    @keyframes slideIn { 
      from { transform: translateX(120px); opacity: 0; } 
      to { transform: translateX(0); opacity: 1; } 
    }

    .highlight {
      animation: highlight 1.5s;
    }
    @keyframes highlight {
      0%, 100% { border-color: rgba(255,255,255,0.2); }
      50% { border-color: #ffd700; box-shadow: 0 0 20px rgba(255,215,0,0.5); }
    }
  </style>
</head>
<body>
  <div class="container">
    <button class="admin-btn" onclick="loginAdmin()">üîí Admin Login</button>

    <h1>üñºÔ∏è ‡Æé‡Æ©‡Øç Gallery</h1>
    <p class="subtitle">‚ú® ‡Æâ‡Æ©‡Æï‡Øç‡Æï‡ØÅ ‡ÆÆ‡Æü‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡Æ§‡ØÜ‡Æ∞‡Æø‡ÆØ‡ØÅ‡ÆÆ‡Øç... ‡ÆÜ‡Æ©‡Ææ‡Æ≤‡Øç share ‡Æ™‡Æ£‡Øç‡Æ£‡Æ≤‡Ææ‡ÆÆ‡Øç üíô</p>

    <!-- Upload Box - Admin Only -->
    <div class="upload-box" id="uploadBox">
      <div class="drop-zone" id="dropZone">
        üì§ ‡Æï‡Øã‡Æ™‡Øç‡Æ™‡Øà ‡Æá‡Æ¥‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ ‡Æµ‡Æø‡Æü‡ØÅ ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æï‡Æø‡Æ≥‡Æø‡Æï‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç
        <input type="file" id="fileInput" accept="image/*,video/*" hidden />
      </div>
      <div class="preview" id="preview"></div>
      <input type="text" id="nameInput" placeholder="üìù ‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øç (optional)" />
      <textarea id="descInput" placeholder="üí¨ ‡Æµ‡Æø‡Æ≥‡Æï‡Øç‡Æï‡ÆÆ‡Øç... (optional)" rows="3"></textarea>
      <button id="uploadBtn" disabled>‚¨ÜÔ∏è ‡Æ™‡Æ§‡Æø‡Æµ‡Øá‡Æ±‡Øç‡Æ±‡ØÅ</button>
    </div>

    <div class="gallery" id="gallery"></div>
  </div>

  <script>
    const REPO = 'adflyaa/theepika_sweety';
    const DATA_PATH = 'docs/data.json';
    const PASSWORD = 'uu934587kk';
    
    let files = [];
    let likes = JSON.parse(localStorage.getItem('gallery_likes') || '{}');
    let isAdmin = false;

    // Login Admin
    function loginAdmin() {
      const pwd = prompt('üîí Admin Password:');
      if (pwd === PASSWORD) {
        isAdmin = true;
        document.getElementById('uploadBox').classList.add('show');
        document.querySelectorAll('.admin-actions').forEach(el => el.classList.add('show'));
        showToast('‚úÖ Admin mode activated!');
        document.querySelector('.admin-btn').textContent = '‚úì Admin Mode';
      } else if (pwd) {
        showToast('‚ùå Wrong password!', true);
      }
    }

    // Load data
    async function loadData() {
      try {
        const res = await fetch(`https://raw.githubusercontent.com/${REPO}/main/${DATA_PATH}?t=${Date.now()}`);
        if (!res.ok) throw new Error('Data not found');
        files = await res.json();
        renderGallery();
        trackViews();
      } catch (err) {
        console.error('Load error:', err);
        document.getElementById('gallery').innerHTML = '<div class="empty">üì≠ ‡Æá‡Æ©‡Øç‡Æ©‡ØÅ‡ÆÆ‡Øç ‡Æï‡Øã‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡Øç ‡Æá‡Æ≤‡Øç‡Æ≤‡Øà</div>';
      }
    }

    // Render gallery
    function renderGallery() {
      const urlId = new URLSearchParams(location.search).get('id');
      
      if (files.length === 0) {
        document.getElementById('gallery').innerHTML = '<div class="empty">üì≠ ‡Æá‡Æ©‡Øç‡Æ©‡ØÅ‡ÆÆ‡Øç ‡Æï‡Øã‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡Øç ‡Æá‡Æ≤‡Øç‡Æ≤‡Øà</div>';
        return;
      }

      document.getElementById('gallery').innerHTML = files.map((f, i) => `
        <div class="card ${f.id === urlId ? 'highlight' : ''}" id="card-${f.id}">
          ${f.type.startsWith('image') 
            ? `<img src="${f.data}" class="media" alt="${f.name}">` 
            : `<video src="${f.data}" class="media" controls></video>`}
          <div class="info">
            <div class="name">${f.name}</div>
            ${f.desc ? `<div class="desc">${f.desc}</div>` : ''}
            
            <!-- Stats - Visible to everyone -->
            <div class="stats">
              <span>üëÅÔ∏è ${f.views || 0} views</span>
              <div class="like-btn ${likes[f.id] ? 'liked' : ''}" onclick="toggleLike(${i})">
                ${likes[f.id] ? '‚ù§Ô∏è' : 'ü§ç'} ${f.likes || 0}
              </div>
            </div>
            
            <!-- Admin Actions - Only visible when logged in -->
            <div class="admin-actions ${isAdmin ? 'show' : ''}">
              <button class="action-btn" style="background:linear-gradient(135deg, #11998e 0%, #38ef7d 100%);" onclick="downloadFile(${i})">‚¨áÔ∏è Download</button>
              <button class="action-btn" style="background:linear-gradient(135deg, #4481eb 0%, #04befe 100%);" onclick="shareFile(${i})">üîó Share</button>
            </div>
          </div>
        </div>
      `).join('');

      // Scroll to highlighted card
      if (urlId) {
        setTimeout(() => {
          const card = document.getElementById('card-' + urlId);
          if (card) card.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 500);
      }
    }

    // Like system - Available to everyone
    function toggleLike(index) {
      const fileId = files[index].id;
      if (likes[fileId]) {
        showToast('‚ö†Ô∏è ‡Æè‡Æ±‡Øç‡Æï‡Æ©‡Æµ‡Øá like ‡Æ™‡Øã‡Æü‡Øç‡Æü‡Ææ‡ÆØ‡Øç!', true);
        return;
      }
      
      files[index].likes = (files[index].likes || 0) + 1;
      likes[fileId] = true;
      localStorage.setItem('gallery_likes', JSON.stringify(likes));
      
      updateData();
      renderGallery();
      showToast('‚ù§Ô∏è Like ‡Æ™‡Øã‡Æü‡Øç‡Æü‡Ææ‡ÆØ‡Øç!');
    }

    // Share - Admin only
    function shareFile(index) {
      if (!isAdmin) return;
      const file = files[index];
      const url = `${location.origin}${location.pathname}?id=${file.id}`;
      
      navigator.clipboard.writeText(url).then(() => {
        showToast('üîó Link copied! WhatsApp-‡Æ≤‡Øç paste ‡Æö‡ØÜ‡ÆØ‡Øç');
      });
      
      if (navigator.share) {
        navigator.share({
          title: file.name,
          text: file.desc || 'Check this out!',
          url: url
        }).catch(() => {});
      }
    }

    // Download - Admin only
    function downloadFile(index) {
      if (!isAdmin) return;
      const file = files[index];
      const a = document.createElement('a');
      a.href = file.data;
      a.download = file.name;
      a.click();
      showToast('‚¨áÔ∏è Download started!');
    }

    // Track views - Everyone
    function trackViews() {
      const sessionViews = JSON.parse(sessionStorage.getItem('gallery_views') || '{}');
      let updated = false;
      
      files.forEach(f => {
        if (!sessionViews[f.id]) {
          f.views = (f.views || 0) + 1;
          sessionViews[f.id] = true;
          updated = true;
        }
      });
      
      if (updated) {
        sessionStorage.setItem('gallery_views', JSON.stringify(sessionViews));
        updateData();
      }
    }

    // Update GitHub - Admin only
    async function updateData() {
      if (!isAdmin) return;
      
      try {
        const shaRes = await fetch(`https://api.github.com/repos/${REPO}/contents/${DATA_PATH}`);
        if (!shaRes.ok) throw new Error('Cannot get SHA');
        const shaData = await shaRes.json();
        
        await fetch(`https://api.github.com/repos/${REPO}/contents/${DATA_PATH}`, {
          method: 'PUT',
          headers: {
            'Authorization': 'token GH_PAT_WILL_BE_HERE',
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            message: 'Update gallery data',
            content: btoa(unescape(encodeURIComponent(JSON.stringify(files, null, 2)))),
            sha: shaData.sha
          })
        });
      } catch (err) {
        console.error('Update error:', err);
      }
    }

    // Upload functionality - Admin only
    document.getElementById('dropZone').onclick = () => {
      if (isAdmin) document.getElementById('fileInput').click();
    };
    
    document.getElementById('fileInput').onchange = (e) => {
      const file = e.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = (ev) => {
        const previewHtml = file.type.startsWith('image')
          ? `<img src="${ev.target.result}">`
          : `<video src="${ev.target.result}" controls></video>`;
        
        document.getElementById('preview').innerHTML = previewHtml;
        document.getElementById('uploadBtn').disabled = false;
      };
      reader.readAsDataURL(file);
    };

    document.getElementById('uploadBtn').onclick = () => {
      const file = document.getElementById('fileInput').files[0];
      if (!file) return;
      
      const name = document.getElementById('nameInput').value || file.name;
      const desc = document.getElementById('descInput').value;
      
      showToast('‚è≥ Uploading...');
      
      const reader = new FileReader();
      reader.onload = (ev) => {
        const newFile = {
          id: Date.now().toString(),
          name: name,
          desc: desc,
          data: ev.target.result,
          type: file.type,
          likes: 0,
          views: 0
        };
        
        files.unshift(newFile);
        updateData();
        
        setTimeout(() => {
          loadData();
          
          // Reset form
          document.getElementById('preview').innerHTML = '';
          document.getElementById('nameInput').value = '';
          document.getElementById('descInput').value = '';
          document.getElementById('fileInput').value = '';
          document.getElementById('uploadBtn').disabled = true;
          
          showToast('‚úÖ ‡Æ™‡Æ§‡Æø‡Æµ‡Øá‡Æ±‡Øç‡Æ±‡ÆÆ‡Øç ‡Æµ‡ØÜ‡Æ±‡Øç‡Æ±‡Æø!');
        }, 1000);
      };
      reader.readAsDataURL(file);
    };

    // Toast notification
    function showToast(message, isError = false) {
      const toast = document.createElement('div');
      toast.className = 'toast' + (isError ? ' error' : '');
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    // Initial load
    loadData();
  </script>
</body>
        </html>
